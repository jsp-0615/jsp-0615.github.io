<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>SQL44 查询连续入住多晚的客户信息？</title>
      <link href="/problemNotes/2025/04/12/SQL44/"/>
      <url>/problemNotes/2025/04/12/SQL44/</url>
      
        <content type="html"><![CDATA[<h1 id="SQL44查询连续入住多晚的客户信息？"><a href="#SQL44查询连续入住多晚的客户信息？" class="headerlink" title="SQL44查询连续入住多晚的客户信息？"></a>SQL44查询连续入住多晚的客户信息？</h1><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>某酒店客房信息数据及某晚入住信息数据如下：</p><p>客房信息表<strong>guestroom_tb</strong>(room_id-房间号,room_type-房间类型,room_price-房间价格)，如下所示：</p><table><thead><tr><th>room_id</th><th>room_type</th><th>room_price</th></tr></thead><tbody><tr><td>1001</td><td>商务标准房</td><td>165</td></tr><tr><td>1002</td><td>家庭套房</td><td>376</td></tr><tr><td>1003</td><td>商务单人房</td><td>100</td></tr><tr><td>1004</td><td>商务单人房</td><td>100</td></tr><tr><td>1005</td><td>商务标准房</td><td>165</td></tr><tr><td>1006</td><td>商务单人房</td><td>100</td></tr><tr><td>1007</td><td>商务标准房</td><td>165</td></tr><tr><td>1008</td><td>家庭套房</td><td>365</td></tr><tr><td>1009</td><td>商务标准房</td><td>165</td></tr></tbody></table><p>入住信息表<strong>checkin_tb</strong>(info_id-信息id.room_id-房间号,user_id-客户id,checkin_time-入住时间,checkout_time-退房时间)，</p><p>该表存储该晚客户入住信息及后续退房信息，如下所示：</p><table><thead><tr><th>info_id</th><th>room_id</th><th>user_id</th><th>checkin_time</th><th>checkout_time</th></tr></thead><tbody><tr><td>1</td><td>1001</td><td>201</td><td>2022-06-12 15:00:00</td><td>2022-06-13 09:00:00</td></tr><tr><td>2</td><td>1001</td><td>202</td><td>2022-06-12 15:00:00</td><td>2022-06-13 09:00:00</td></tr><tr><td>3</td><td>1003</td><td>203</td><td>2022-06-12 14:00:00</td><td>2022-06-14 08:00:00</td></tr><tr><td>4</td><td>1004</td><td>204</td><td>2022-06-12 15:00:00</td><td>2022-06-13 11:00:00</td></tr><tr><td>5</td><td>1007</td><td>205</td><td>2022-06-12 16:00:00</td><td>2022-06-15 12:00:00</td></tr><tr><td>6</td><td>1008</td><td>206</td><td>2022-06-12 19:00:00</td><td>2022-06-13 12:00:00</td></tr><tr><td>7</td><td>1008</td><td>207</td><td>2022-06-12 19:00:00</td><td>2022-06-13 12:00:00</td></tr><tr><td>8</td><td>1009</td><td>208</td><td>2022-06-12 20:00:00</td><td>2022-06-16 09:00:00</td></tr></tbody></table><p>问题：请查询该酒店从6月12日开始连续入住多晚的客户信息？</p><p>要求输出：客户id、房间号、房间类型、连续入住天数（按照连续入住天数的升序排序，再按照房间号的升序排序，再按照客户id的降序排序）</p><p>示例数据结果如下：</p><table><thead><tr><th>user_id</th><th>room_id</th><th>room_type</th><th>days</th></tr></thead><tbody><tr><td>203</td><td>1003</td><td>商务单人房</td><td>2</td></tr><tr><td>205</td><td>1007</td><td>商务标准房</td><td>3</td></tr><tr><td>208</td><td>1009</td><td>商务标准房</td><td>4</td></tr></tbody></table><p>解释：以客户203为例，在2022-06-12入住酒店，在2022-06-14退房，连续在12日晚、13日晚入住在该酒店，故结果如上；其他结果同理。</p><p>示例输入：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span>  `guestroom_tb` ; </span><br><span class="line"><span class="keyword">CREATE TABLE</span> `guestroom_tb` (</span><br><span class="line">`room_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">`room_type` <span class="type">varchar</span>(<span class="number">16</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">`room_price` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY KEY</span> (`room_id`));</span><br><span class="line"><span class="keyword">INSERT INTO</span> guestroom_tb <span class="keyword">VALUES</span>(<span class="number">1001</span>,<span class="string">&#x27;商务标准房&#x27;</span>,<span class="number">165</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> guestroom_tb <span class="keyword">VALUES</span>(<span class="number">1002</span>,<span class="string">&#x27;家庭套房&#x27;</span>,<span class="number">376</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> guestroom_tb <span class="keyword">VALUES</span>(<span class="number">1003</span>,<span class="string">&#x27;商务单人房&#x27;</span>,<span class="number">100</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> guestroom_tb <span class="keyword">VALUES</span>(<span class="number">1004</span>,<span class="string">&#x27;商务单人房&#x27;</span>,<span class="number">100</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> guestroom_tb <span class="keyword">VALUES</span>(<span class="number">1005</span>,<span class="string">&#x27;商务标准房&#x27;</span>,<span class="number">165</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> guestroom_tb <span class="keyword">VALUES</span>(<span class="number">1006</span>,<span class="string">&#x27;商务单人房&#x27;</span>,<span class="number">100</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> guestroom_tb <span class="keyword">VALUES</span>(<span class="number">1007</span>,<span class="string">&#x27;商务标准房&#x27;</span>,<span class="number">165</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> guestroom_tb <span class="keyword">VALUES</span>(<span class="number">1008</span>,<span class="string">&#x27;家庭套房&#x27;</span>,<span class="number">365</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> guestroom_tb <span class="keyword">VALUES</span>(<span class="number">1009</span>,<span class="string">&#x27;商务标准房&#x27;</span>,<span class="number">165</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span>  `checkin_tb` ; </span><br><span class="line"><span class="keyword">CREATE TABLE</span> `checkin_tb` (</span><br><span class="line">`info_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">`room_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">`user_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">`checkin_time` datetime <span class="keyword">NOT NULL</span>,</span><br><span class="line">`checkout_time` datetime <span class="keyword">NOT NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY KEY</span> (`info_id`));</span><br><span class="line"><span class="keyword">INSERT INTO</span> checkin_tb <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">1001</span>,<span class="number">201</span>,<span class="string">&#x27;2022-06-12 15:00:00&#x27;</span>,<span class="string">&#x27;2022-06-13 09:00:00&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> checkin_tb <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="number">1001</span>,<span class="number">202</span>,<span class="string">&#x27;2022-06-12 15:00:00&#x27;</span>,<span class="string">&#x27;2022-06-13 09:00:00&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> checkin_tb <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="number">1003</span>,<span class="number">203</span>,<span class="string">&#x27;2022-06-12 14:00:00&#x27;</span>,<span class="string">&#x27;2022-06-14 08:00:00&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> checkin_tb <span class="keyword">VALUES</span>(<span class="number">4</span>,<span class="number">1004</span>,<span class="number">204</span>,<span class="string">&#x27;2022-06-12 15:00:00&#x27;</span>,<span class="string">&#x27;2022-06-13 11:00:00&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> checkin_tb <span class="keyword">VALUES</span>(<span class="number">5</span>,<span class="number">1007</span>,<span class="number">205</span>,<span class="string">&#x27;2022-06-12 16:00:00&#x27;</span>,<span class="string">&#x27;2022-06-15 12:00:00&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> checkin_tb <span class="keyword">VALUES</span>(<span class="number">6</span>,<span class="number">1008</span>,<span class="number">206</span>,<span class="string">&#x27;2022-06-12 19:00:00&#x27;</span>,<span class="string">&#x27;2022-06-13 12:00:00&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> checkin_tb <span class="keyword">VALUES</span>(<span class="number">7</span>,<span class="number">1008</span>,<span class="number">207</span>,<span class="string">&#x27;2022-06-12 19:00:00&#x27;</span>,<span class="string">&#x27;2022-06-13 12:00:00&#x27;</span>); </span><br><span class="line"><span class="keyword">INSERT INTO</span> checkin_tb <span class="keyword">VALUES</span>(<span class="number">8</span>,<span class="number">1009</span>,<span class="number">208</span>,<span class="string">&#x27;2022-06-12 20:00:00&#x27;</span>,<span class="string">&#x27;2022-06-16 09:00:00&#x27;</span>);</span><br></pre></td></tr></table></figure><p>答案</p><p>这道题对我的难点在于，在group by的时候，想要输出哪些列group by的时候就要写哪些，我这里用group by是因为我怕同一个顾客有多次入住记录，比如用户201他在6月12日有过入住记录，如果它6月15号还有入住记录，这时候就需要有区别。</p><p><code>DATE(ct.checkin_time) = &#39;2022-06-12&#39;</code>：选择在2022年6月12日入住的记录。<code>DATEDIFF(ct.checkout_time, ct.checkin_time) &gt;= 2</code>：选择连续入住至少两晚的记录（注意不要在where直接使用days&gt;&#x3D; 2）。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    user_id,</span><br><span class="line">    g.room_id,</span><br><span class="line">    room_type,</span><br><span class="line">    <span class="keyword">day</span> (checkout_time) <span class="operator">-</span> <span class="keyword">day</span> (checkin_time) <span class="keyword">as</span> days</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span></span><br><span class="line">            user_id,</span><br><span class="line">            c.room_id,</span><br><span class="line">            checkin_time,</span><br><span class="line">            checkout_time</span><br><span class="line">        <span class="keyword">from</span></span><br><span class="line">            checkin_tb <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">            user_id,</span><br><span class="line">            c.room_id,</span><br><span class="line">            checkin_time,</span><br><span class="line">            checkout_time</span><br><span class="line">    ) temp</span><br><span class="line">    <span class="keyword">inner</span> <span class="keyword">join</span> guestroom_tb <span class="keyword">as</span> g <span class="keyword">on</span> g.room_id <span class="operator">=</span> temp.room_id</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">    <span class="type">DATE</span> (temp.checkin_time) <span class="operator">&gt;=</span> <span class="string">&#x27;2022-06-12&#x27;</span></span><br><span class="line">    <span class="keyword">and</span> <span class="keyword">day</span> (checkout_time) <span class="operator">-</span> <span class="keyword">day</span> (checkin_time) <span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">    days,</span><br><span class="line">    g.room_id,</span><br><span class="line">    user_id <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><p>题解代码</p><p>注意使用DATEDIFF函数，然后where语句不能直接使用days来做判断条件，但是我觉得题解这里没有解决同一个顾客如果有多条记录的情况怎么解决</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    ct.user_id,</span><br><span class="line">    ct.room_id,</span><br><span class="line">    gt.room_type,</span><br><span class="line">    DATEDIFF(ct.checkout_time, ct.checkin_time) <span class="keyword">AS</span> days</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    checkin_tb ct</span><br><span class="line"><span class="keyword">JOIN</span> </span><br><span class="line">    guestroom_tb gt <span class="keyword">ON</span> gt.room_id <span class="operator">=</span> ct.room_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">   <span class="type">DATE</span>(ct.checkin_time) <span class="operator">=</span> <span class="string">&#x27;2022-06-12&#x27;</span> <span class="keyword">AND</span> DATEDIFF(ct.checkout_time, ct.checkin_time) <span class="operator">&gt;=</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">    days <span class="keyword">ASC</span>, ct.room_id <span class="keyword">ASC</span>, ct.user_id <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> problemNotes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> notes </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The First Blog</title>
      <link href="/knowledgeNotes/2025/04/12/my-first-blog/"/>
      <url>/knowledgeNotes/2025/04/12/my-first-blog/</url>
      
        <content type="html"><![CDATA[<h1 id="The-first-blog"><a href="#The-first-blog" class="headerlink" title="The first blog"></a>The first blog</h1><p>时间开始于2025&#x2F;4&#x2F;12，周六，晚上20:45，终于千难万险将所有前期准备弄完了！接下来我会定期将自己的学习笔记跟新在这里，一方面督促自己努力学习，同时将脑中知识整理成可以发布出去的版本！</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>嗯。。。简单介绍一下自己，我是一名悉大的学生Jasper，正在学习Data Science，但目前的就业情况呢，导致我这种学历的人呢，上不上，下不下的，所以我想以博客的形式督促增加自己的技能点，点亮所有必要的知识点，目前呢自己的状态就是啥都会一点，但是啥都不是那么会，包括最基础的Python&#x2F;SQL&#x2F;R，Machine Learning，Deep Learning，作为一个计算机科班出生的，Java自然也不在话下，算法嘛会点，但绝对不多，大数据框架Hadoop好像是学完了，但好像又没有，Hive，Spark现在还在学习中</p><p>最后用看到张一鸣说过的一句话来结尾</p><p>做正确的事才是务实，短期投机不是务实。大力出奇迹事务实，刨根问底是务实，抓住本之是务实，尊重用户是务实，认识世界的多样性是务实。</p>]]></content>
      
      
      <categories>
          
          <category> knowledgeNotes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> notes </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
